# Changelog

## [1.5.0] - 2026-02-19

### 新增 / 改动

- **破坏后连通规则**：每批原子被破坏后，(1) 检查该格剩余原子是否连通，不连通则由被破坏方选择保留一个连通子集；(2) 仅看黑原子是否连通，若存在多个黑原子连通子集则由被破坏方选择保留一个，未选中的黑连通子集全部破坏；(3) 再自动清除所有「不包含黑原子」的连通子集。进攻与红效果均按此流程结算。
- **批量放置黑原子**：新增黑原子必须与现有某个黑原子相邻（格内无黑时第一个可放在中心或与任意原子相邻作为种子，其后均须与黑相邻）。

---

## [1.4.0] - 2026-02-19

### 新增 / 改动

- **进攻次数**：每回合可进攻次数 = 己方「有黑原子的格子」数（结束排布时确定）。
- **规则明细**：规则 overlay 中补充「原子持续性效果」（黑/红/蓝/绿各自持续作用说明）。
- **批量放置**：数量改为滑条调节；面板加大、选格按钮均布、取消按钮区分颜色；放置时保证与已有原子（含红/蓝/绿）连通。
- **确认弹窗**：结束排布、结束回合前弹出「是否确认」；直接攻击确认弹窗点击「是/否」可正常响应。
- **红效果**：发动前需先选择对方一个格子（窗口），破坏仅作用于该格。
- **开局选项**：默认勾选「随机破坏」与「批量随机布置黑原子」。

### 修复

- 攻击/红效果结算后：无黑原子的格子整格清空；多连通分量时先自动清除不含黑的子集，再让被攻击方选择保留哪一块（若已无多块则无需选择）。
- 直接攻击确认弹窗无反应：移除提前消费点击的逻辑，使「是/否」点击可正确处理。

---

## [1.3.0] - 2026-02-19

### 新增 / 改动

- **阶段 0**：三选一按钮改为左侧竖排，位于拖拽原子列右侧；不再使用居中弹窗。
- **HUD**：血条旁增加玩家头像（圆形 P0/P1）；血条上方移除重复的 P0/P1 文字；回合状态框与操作提示框分色（蓝灰/绿灰）、位置上移；操作提示框加宽并支持文字换行。
- **阶段 3 提示**：操作框中写明红/蓝/绿效果数目（红=破坏y个对方黑原子，蓝=得y黑，绿=回y血，y=邻黑数）。
- **场地**：每格下方显示 ATK/DEF；无原子格点缩小且颜色变浅；格子间距与双方场地上下间距加大；整体场地右移。
- **排布阶段**：原子池与撤回/结束排布竖排于屏幕左侧；颜色块仅显示数字；结束排布按钮加宽。
- **红效果规则**：仅能破坏对方黑原子；防守方选择要破坏的黑原子（红高亮），可再点撤销；选够后点「确认」；对方黑原子不足 y 时选满即可确认。
- **攻击**：选择进攻格后点击对方空格子会正确造成直接伤害。
- **破坏结算**：每次破坏原子后移除无黑原子的连通分量；若产生多个连通分量则由被破坏方选择保留哪一块。
- **破坏反馈**：原子被破坏时播放专用音效与扩散淡出动画。

### 修复

- 攻击时点击对方空格子无反应：为「对方格为空」分支施加直接伤害并结束本次进攻。

---

## [1.2.0] - 2026-02-19

### 新增 / 改动

- **拖动视角**：新增「拖动视角」按钮，开启后可在任意格子内按住拖动，整格几何（六边形、网格、原子）随视窗移动。
- **连续滑动**：拖动时网格相对屏幕平滑连续滑动（像素级偏移），不再按整格顿挫。

---

## [1.1.0] - 2026-02-19

### 新增 / 改动

- 网格规模：每格为 41×41 背板，可放置区域限定为**大正六边形**（半径 18 环），仅六边形内可放原子。
- 三角形边长固定为格子边长的 1/4；视窗 14×14，初始居中于六边形。
- 格子外遮蔽：六边形外区域用边框色填充，网格与背景仅在六边形内显示。
- 移除「拖动视角」逻辑与按钮，简化交互。

### 修复

- 拖动原子到格点松手无法放置：`screen_to_grid` 对越界 (r,c) 做钳位，保证格内松手总能得到有效格点。

---

## [1.0.0] - 2025-02-19

### 新增 / 改动

- 双人回合制原子对战：3 格场地、黑/红/蓝/绿原子、阶段 0（选效果）/2（排布）/3（动作）。
- 界面：双方场地居中；每格带边框与米色背景；原子缩小显示；拖动原子时无外框幽灵。
- 排布阶段：本回合新放原子高亮；支持「撤回」按钮，确定布置前可撤销。
- 动作阶段：进攻与红/蓝/绿效果点击交互完整（选黑原子破坏、额外破坏、选连通区域、红效果选目标）。
- 绿原子回血：血量满时也可继续加血。
- 音效：放置、进攻、效果、回合结束、点击、撤回等事件均有音效；无 ogg 时使用程序合成（需 numpy）。
- 拖动视角：每格支持「拖动视角」模式，在格内拖动可平移网格显示。
- HUD：血条与原子数量图形面板（当前玩家高亮）。

### 修复

- 阶段 3 点击格子未响应：用 consumed 标志区分按钮与格子点击，保证进攻/效果交互生效。
- 进攻时「点击破坏黑原子」未响应：将 attack_choose_black 分支从 attack_choose_extra 内移出为同级 elif。
